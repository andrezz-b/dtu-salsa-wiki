---
import Base from "@/layouts/Base.astro";
import { getCollection } from "astro:content";
import { FaArrowRight } from "react-icons/fa";
import Card from "@/helpers/Card";

// Fetch latest moves
const moves = await getCollection("moves", ({ data }) => !data.draft);
const latestMoves = moves
  .sort((a, b) => {
    const dateA = a.data.created_date ? a.data.created_date.getTime() : 0;
    const dateB = b.data.created_date ? b.data.created_date.getTime() : 0;
    return dateB - dateA;
  })
  .slice(0, 5);

// Fetch latest concepts
const concepts = await getCollection("concepts", ({ data }) => !data.draft);
const latestConcepts = concepts
  .sort((a, b) => {
    const dateA = a.data.created_date ? a.data.created_date.getTime() : 0;
    const dateB = b.data.created_date ? b.data.created_date.getTime() : 0;
    return dateB - dateA;
  })
  .slice(0, 5);
---

<Base>
  <!-- Hero Section -->
  <section
    class="section pt-20 pb-16 bg-linear-to-b from-primary/10 to-transparent dark:from-darkmode-primary/10"
  >
    <div class="container">
      <div class="row justify-center">
        <div class="lg:col-8 md:col-10 text-center">
          <h1 class="mb-4 text-h3 lg:text-h1">Welcome to DTU Salsa Wiki</h1>
          <p class="mb-8 text-lg">Your community-driven guide to salsa moves and concepts.</p>

          <!-- Search Bar -->
          <div
            data-search-trigger
            class="cursor-pointer bg-white dark:bg-darkmode-theme-light rounded-lg px-4 py-3 shadow-lg flex items-center gap-2 max-w-lg mx-auto border border-border dark:border-darkmode-border hover:border-primary transition-colors"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-gray-500 dark:text-gray-400"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <span class="text-gray-500 dark:text-gray-400">Search moves, concepts...</span>
            <span
              class="ml-auto text-xs text-gray-400 border border-gray-200 dark:border-gray-700 rounded px-1.5 py-0.5"
              >âŒ˜K</span
            >
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Latest Moves Section -->
  <section class="section-sm">
    <div class="container">
      <div class="flex justify-between items-end mb-8">
        <h2 class="h3 mb-0">Latest Moves</h2>
        <a href="/moves" class="btn btn-outline-primary btn-sm flex items-center gap-2">
          View All <FaArrowRight />
        </a>
      </div>
      <div class="row g-4">
        {
          latestMoves.map((move) => (
            <div class="md:col-6 lg:col-4">
              <Card
                title={move.data.title}
                href={`/moves/${move.id}`}
                level={move.data.level}
                type={move.data.type}
                difficulty={move.data.difficulty}
              />
            </div>
          ))
        }
      </div>
    </div>
  </section>

  <!-- Latest Concepts Section -->
  <section class="section-sm pt-0">
    <div class="container">
      <div class="flex justify-between items-end mb-8">
        <h2 class="h3 mb-0">Latest Concepts</h2>
        <a href="/concepts" class="btn btn-outline-primary btn-sm flex items-center gap-2">
          View All <FaArrowRight />
        </a>
      </div>
      <div class="row g-4">
        {
          latestConcepts.map((concept) => (
            <div class="md:col-6 lg:col-4">
              <Card
                title={concept.data.title}
                href={`/concepts/${concept.id}`}
                level={concept.data.level}
                type={concept.data.type}
              />
            </div>
          ))
        }
      </div>
    </div>
  </section>
</Base>
