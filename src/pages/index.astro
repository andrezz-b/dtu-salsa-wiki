---
import Base from "@/layouts/Base.astro";
import { getCollection } from "astro:content";
import { FaArrowRight } from "react-icons/fa";
import Card from "@/helpers/Card";

const LATEST_COUNT = 6;

// Fetch latest moves
const moves = await getCollection("moves", ({ data }) => !data.draft);
const latestMoves = moves
  .sort((a, b) => {
    const dateA = a.data.created_date ? a.data.created_date.getTime() : 0;
    const dateB = b.data.created_date ? b.data.created_date.getTime() : 0;
    return dateB - dateA;
  })
  .slice(0, LATEST_COUNT);

// Fetch latest concepts
const concepts = await getCollection("concepts", ({ data }) => !data.draft);
const latestConcepts = concepts
  .sort((a, b) => {
    const dateA = a.data.created_date ? a.data.created_date.getTime() : 0;
    const dateB = b.data.created_date ? b.data.created_date.getTime() : 0;
    return dateB - dateA;
  })
  .slice(0, LATEST_COUNT);
---

<Base>
  <!-- Hero Section -->
  <section
    class="relative min-h-[70vh] flex items-center justify-center overflow-hidden"
  >
    <!-- Background with gradient -->
    <div
      class="absolute inset-0 bg-linear-to-br from-accent/20 via-accent/5 to-transparent dark:from-darkmode-accent/20 dark:via-darkmode-accent/5 dark:to-transparent"
    >
    </div>

    <!-- Decorative blurred circles -->
    <div
      class="absolute top-20 left-10 w-72 h-72 bg-accent/30 dark:bg-darkmode-accent/20 rounded-full blur-3xl"
    >
    </div>
    <div
      class="absolute bottom-20 right-10 w-96 h-96 bg-accent/20 dark:bg-darkmode-accent/15 rounded-full blur-3xl"
    >
    </div>
    <div
      class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-accent/10 dark:bg-darkmode-accent/10 rounded-full blur-3xl"
    >
    </div>

    <!-- Content -->
    <div class="container relative z-10">
      <div class="max-w-2xl mx-auto text-center">
        <h1
          class="mb-6 text-h2 md:text-h1 lg:text-[3.5rem] font-bold leading-tight"
        >
          Your Digital <span class="text-accent dark:text-darkmode-accent"
            >Salsa</span
          > Notebook
        </h1>

        <p
          class="mb-10 text-lg md:text-xl text-text-light dark:text-darkmode-text-light max-w-lg mx-auto"
        >
          A quick-reference library for moves you learned in class.
        </p>

        <!-- Search Bar -->
        <div
          data-search-trigger
          class="cursor-pointer bg-white dark:bg-darkmode-body rounded-2xl px-5 py-4 shadow-xl flex items-center gap-3 max-w-xl mx-auto border-2 border-border dark:border-darkmode-border hover:border-accent dark:hover:border-darkmode-accent transition-all duration-300 hover:shadow-2xl hover:shadow-accent/10 group"
        >
          <svg
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-gray-400 group-hover:text-accent dark:group-hover:text-darkmode-accent transition-colors"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          <span class="text-gray-400 text-lg">Search moves, concepts...</span>
          <span
            class="ml-auto text-xs text-gray-400 bg-gray-100 dark:bg-darkmode-light border border-gray-200 dark:border-darkmode-border rounded-lg px-2 py-1 hidden lg:inline search-shortcut-key font-mono"
            >âŒ˜K</span
          >
        </div>

        <!-- Quick stats -->
        <div
          class="mt-12 flex items-center justify-center gap-8 md:gap-12 text-sm"
        >
          <div class="text-center">
            <div
              class="text-2xl md:text-3xl font-bold text-text-dark dark:text-darkmode-text-dark"
            >
              {moves.length}
            </div>
            <div class="text-text-light dark:text-darkmode-text-light">
              Moves
            </div>
          </div>
          <div class="w-px h-10 bg-border dark:bg-darkmode-border"></div>
          <div class="text-center">
            <div
              class="text-2xl md:text-3xl font-bold text-text-dark dark:text-darkmode-text-dark"
            >
              {concepts.length}
            </div>
            <div class="text-text-light dark:text-darkmode-text-light">
              Concepts
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Latest Moves Section -->
  <section class="py-16 md:py-24 relative overflow-hidden">
    <!-- Subtle background decoration -->
    <div
      class="absolute top-0 right-0 w-96 h-96 bg-accent/5 dark:bg-darkmode-accent/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"
    >
    </div>

    <div class="container relative z-10">
      <!-- Section Header -->
      <div
        class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4 mb-10"
      >
        <div>
          <span
            class="inline-flex items-center gap-2 text-sm font-medium text-accent dark:text-gray-400 mb-2"
          >
            <span class="w-8 h-px bg-accent dark:bg-gray-400"></span>
            Explore
          </span>
          <h2 class="text-h3 md:text-h2 font-bold">
            Latest <span class="text-accent dark:text-darkmode-accent"
              >Moves</span
            >
          </h2>
        </div>
        <a
          href="/moves"
          class="group inline-flex items-center gap-2 text-sm font-semibold text-text-dark dark:text-darkmode-text-dark hover:text-accent dark:hover:text-darkmode-accent transition-colors self-start sm:self-auto"
        >
          View All
          <span
            class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-light dark:bg-darkmode-light group-hover:bg-accent/10 dark:group-hover:bg-darkmode-accent/10 transition-all group-hover:translate-x-1"
          >
            <FaArrowRight className="w-3 h-3" />
          </span>
        </a>
      </div>

      <!-- Cards Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {
          latestMoves.map((move) => (
            <Card
              title={move.data.title}
              href={`/moves/${move.id}`}
              level={move.data.level}
              type={move.data.type}
              difficulty={move.data.difficulty}
            />
          ))
        }
      </div>
    </div>
  </section>

  <!-- Latest Concepts Section -->
  <section
    class="py-16 md:py-24 bg-light/50 dark:bg-darkmode-light/50 relative overflow-hidden"
  >
    <!-- Subtle background decoration -->
    <div
      class="absolute bottom-0 left-0 w-96 h-96 bg-accent/5 dark:bg-darkmode-accent/5 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"
    >
    </div>

    <div class="container relative z-10">
      <!-- Section Header -->
      <div
        class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4 mb-10"
      >
        <div>
          <span
            class="inline-flex items-center gap-2 text-sm font-medium text-accent dark:text-gray-400 mb-2"
          >
            <span class="w-8 h-px bg-gray-400 dark:bg-gray-400"></span>
            Learn
          </span>
          <h2 class="text-h3 md:text-h2 font-bold">
            Latest <span class="text-accent dark:text-darkmode-accent"
              >Concepts</span
            >
          </h2>
        </div>
        <a
          href="/concepts"
          class="group inline-flex items-center gap-2 text-sm font-semibold text-text-dark dark:text-darkmode-text-dark hover:text-accent dark:hover:text-darkmode-accent transition-colors self-start sm:self-auto"
        >
          View All
          <span
            class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-light dark:bg-darkmode-light group-hover:bg-accent/10 dark:group-hover:bg-darkmode-accent/10 transition-all group-hover:translate-x-1"
          >
            <FaArrowRight className="w-3 h-3" />
          </span>
        </a>
      </div>

      <!-- Cards Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {
          latestConcepts.map((concept) => (
            <Card
              title={concept.data.title}
              href={`/concepts/${concept.id}`}
              level={concept.data.level}
              type={concept.data.type}
            />
          ))
        }
      </div>
    </div>
  </section>
</Base>
