---
import type { CollectionEntry } from "astro:content";
import ExplorerFolder from "./ExplorerFolder.astro";

interface Props {
  setupMoves?: CollectionEntry<"moves">[];
  exitMoves?: CollectionEntry<"moves">[];
  relatedMoves?: CollectionEntry<"moves">[];
  usedInMoves?: CollectionEntry<"moves">[];
  usedInConcepts?: CollectionEntry<"concepts">[];
  relatedConcepts?: CollectionEntry<"concepts">[];
}

const {
  setupMoves = [],
  exitMoves = [],
  relatedMoves = [],
  usedInMoves = [],
  usedInConcepts = [],
  relatedConcepts = [],
} = Astro.props;

const hasConnections =
  setupMoves.length > 0 ||
  exitMoves.length > 0 ||
  relatedMoves.length > 0 ||
  relatedConcepts.length > 0;

const EXPAND_THRESHOLD = 10;
---

<aside
  class="explorer-sidebar w-full bg-white dark:bg-darkmode-body rounded-2xl border border-border dark:border-darkmode-border overflow-hidden"
>
  <!-- Connections Section -->
  {
    hasConnections && (
      <div class="p-5">
        <div class="text-sm lg:text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">
          Connections
        </div>

        <div class="flex flex-col gap-1">
          {setupMoves.length > 0 && (
            <ExplorerFolder
              title="Setup Moves"
              items={setupMoves}
              type="moves"
              expanded={setupMoves.length <= EXPAND_THRESHOLD}
            />
          )}

          {exitMoves.length > 0 && (
            <ExplorerFolder
              title="Exit Moves"
              items={exitMoves}
              type="moves"
              expanded={exitMoves.length <= EXPAND_THRESHOLD}
            />
          )}

          {relatedMoves.length > 0 && (
            <ExplorerFolder
              title="Related Moves"
              items={relatedMoves}
              type="moves"
              expanded={relatedMoves.length <= EXPAND_THRESHOLD}
            />
          )}

          {relatedConcepts.length > 0 && (
            <ExplorerFolder
              title="Concepts"
              items={relatedConcepts}
              type="concepts"
              expanded={relatedConcepts.length <= EXPAND_THRESHOLD}
            />
          )}
        </div>
      </div>
    )
  }

  {/* Empty State */}
  {
    !hasConnections &&
      usedInMoves.length === 0 &&
      usedInConcepts.length === 0 && (
        <div class="p-5">
          <div class="text-base lg:text-sm text-gray-400 text-center py-4">
            No connections found
          </div>
        </div>
      )
  }

  {/* Used In Section */}
  {
    (usedInMoves.length > 0 || usedInConcepts.length > 0) && (
      <div
        class={`p-5 ${hasConnections ? "border-t border-border dark:border-darkmode-border" : ""}`}
      >
        <div class="text-sm lg:text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">
          Used In
        </div>

        <div class="flex flex-col gap-1">
          {usedInMoves.length > 0 && (
            <ExplorerFolder
              title="Moves"
              items={usedInMoves}
              type="moves"
              expanded={usedInMoves.length <= EXPAND_THRESHOLD}
            />
          )}

          {usedInConcepts.length > 0 && (
            <ExplorerFolder
              title="Concepts"
              items={usedInConcepts}
              type="concepts"
              expanded={usedInConcepts.length <= EXPAND_THRESHOLD}
            />
          )}
        </div>
      </div>
    )
  }
</aside>
